###############################################################################
# DEFINITIONS
##############################################################################

host_image: &host_image "nativeci/cpp-meson:latest"

##############################################################################
# MATRIX
##############################################################################
matrix:
  include:
  # Linux/compilers
  - CC: gcc
    CXX: g++
    CCOM: gcc
    IMAGE: *host_image
  - CC: clang
    CXX: clang++
    CCOM: clang
    IMAGE: *host_image


##############################################################################
# PIPELINE
##############################################################################

pipeline:
  ############################################################################
  # Dependencies

  deps:
    image: ${IMAGE}
    environment:
    - DEBIAN_FRONTEND=noninteractive
    commands:
    - apt-get update -y
    - apt-get install -y libext2fs-dev

  ############################################################################
  # Build

  build:
    image: ${IMAGE}
    commands:
    - ./Gmake.linux


  ############################################################################
  # Tests

  test:
    image: ${IMAGE}
    commands:
    - ./Gmake.linuxtests
